{% extends 'base.html' %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Payment | PropertyPro</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* All your existing styles remain the same */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .card-rotate {
            transform-style: preserve-3d;
            transition: all 0.6s ease;
        }
        .card-back {
            transform: rotateY(180deg);
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
        }
        .card-front {
            backface-visibility: hidden;
        }
        .flip-card .card-rotate {
            transform: rotateY(180deg);
        }
        .payment-processing {
            animation: pulse 1.5s infinite;
        }
        .input-highlight {
            transition: all 0.3s ease;
            box-shadow: 0 0 0 1px rgba(99, 102, 241, 0);
        }
        .input-highlight:focus {
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5);
        }
        .payment-method {
            display: none;
        }
        .payment-method.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        .payment-tab.active {
            background-color: hsl(var(--p));
            color: hsl(var(--pc));
        }
        .floating-badge {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            transform: scale(0);
            animation: ripple 600ms linear;
            pointer-events: none;
        }
        @keyframes ripple {
            to { transform: scale(4); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-base-200 to-base-100 via-base-150 bg-fixed min-h-screen">
    <div class="container mx-auto px-4 py-12 max-w-6xl">
        <!-- Progress Steps -->
        <div class="flex justify-between items-center mb-12 relative">
            <div class="absolute top-1/2 h-1 bg-gray-200 w-full -z-10"></div>
            <div class="absolute top-1/2 h-1 bg-primary w-2/3 -z-10"></div>
            
            <div class="flex flex-col items-center">
                <div class="w-12 h-12 rounded-full bg-primary text-white flex items-center justify-center mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <span class="text-sm font-medium">Plan Selection</span>
            </div>
            
            <div class="flex flex-col items-center">
                <div class="w-12 h-12 rounded-full bg-primary text-white flex items-center justify-center mb-2">
                    <span>2</span>
                </div>
                <span class="text-sm font-medium">Payment</span>
            </div>
            
            <div class="flex flex-col items-center">
                <div class="w-12 h-12 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center mb-2">
                    <span>3</span>
                </div>
                <span class="text-sm text-gray-500">Confirmation</span>
            </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Payment Form -->
            <div class="lg:w-2/3">
                <div class="bg-white rounded-xl shadow-md overflow-hidden p-6 mb-6 transition-all duration-300 hover:shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Payment Details</h2>
                    
                    <!-- Payment Methods Tabs -->
                    <div class="tabs tabs-boxed bg-gray-100 p-1 mb-6" id="payment-tabs">
                        <button class="tab active payment-tab" data-method="credit-card">
                            <i class="far fa-credit-card mr-2"></i> Credit Card
                        </button> 
                        <button class="tab payment-tab" data-method="mpesa">
                            <i class="fas fa-mobile-alt mr-2"></i> MPESA
                        </button> 
                        <button class="tab payment-tab" data-method="bank-transfer">
                            <i class="fas fa-university mr-2"></i> Bank Transfer
                        </button>
                    </div>
                    
                    <!-- Credit Card Form -->
                    <div id="credit-card" class="payment-method active">
                        <!-- Card Preview -->
                        <div class="relative mb-8 h-48 flip-card" id="card-preview">
                            <div class="card-rotate w-full h-full">
                                <div class="card-front bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white shadow-lg h-full flex flex-col justify-between">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-xs opacity-80 mb-1">Card Number</p>
                                            <p class="text-xl font-mono tracking-widest" id="card-number-preview">•••• •••• •••• ••••</p>
                                        </div>
                                        <img src="https://placehold.co/40x25/FFFFFF/000000?text=MC" alt="Card" class="h-6">
                                    </div>
                                    <div class="flex justify-between">
                                        <div>
                                            <p class="text-xs opacity-80 mb-1">Card Holder</p>
                                            <p class="text-sm uppercase" id="card-name-preview">FULL NAME</p>
                                        </div>
                                        <div>
                                            <p class="text-xs opacity-80 mb-1">Expires</p>
                                            <p class="text-sm" id="card-expiry-preview">MM/YY</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-back bg-gradient-to-r from-gray-700 to-gray-900 rounded-xl p-6 text-white shadow-lg h-full">
                                    <div class="h-8 bg-black mb-6 mt-2"></div>
                                    <div class="flex items-center">
                                        <div class="bg-white text-black px-2 py-1 rounded text-xs font-mono" id="card-cvv-preview">•••</div>
                                        <p class="text-xs ml-auto opacity-70">Security Code</p>
                                    </div>
                                </div>
                            </div>
                            <button class="absolute right-4 bottom-4 text-white text-xs opacity-70 hover:opacity-100" onclick="document.getElementById('card-preview').classList.toggle('flip-card')">
                                Show CVV <i class="fas fa-sync-alt ml-1"></i>
                            </button>
                        </div>
                        
                        <!-- Form Fields -->
                        <form id="payment-form" method="post" action="{% url 'payment_callback' %}">
                            {% csrf_token %}
                            <input type="hidden" name="plan_id" value="{{ request.GET.plan|default:'premium' }}">
                            <input type="hidden" name="duration" value="{{ request.GET.duration|default:'30' }}">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">Cardholder Name</label>
                                    <input type="text" id="card-name" name="card_name" class="input input-bordered w-full input-highlight" placeholder="Full name as on card" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 mb-2">Card Number</label>
                                    <input type="text" id="card-number" name="card_number" class="input input-bordered w-full input-highlight font-mono tracking-widest" placeholder="1234 5678 9012 3456" required>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-gray-700 mb-2">Expiry Date</label>
                                        <input type="text" id="card-expiry" name="card_expiry" class="input input-bordered w-full input-highlight" placeholder="MM/YY" required>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 mb-2">Security Code</label>
                                        <input type="text" id="card-cvv" name="card_cvv" class="input input-bordered w-full input-highlight" placeholder="CVV" required>
                                    </div>
                                </div>
                                
                                <div class="pt-4">
                                    <button type="submit" class="btn btn-primary w-full py-3 text-lg">
                                        <span id="submit-text">Pay KES {{ request.GET.amount|default:499 }}</span>
                                        <span id="processing-text" class="hidden payment-processing">
                                            <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            Processing Payment...
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <!-- MPESA Form -->
                    <div id="mpesa" class="payment-method">
                        <div class="text-center py-8">
                            <div class="bg-green-50 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-mobile-alt text-green-600 text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Pay with MPESA</h3>
                            <p class="text-gray-600 mb-6">You'll receive a payment request on your phone</p>
                            
                            <div class="max-w-md mx-auto">
                                <form id="mpesa-form" method="post" action="{% url 'payment_callback' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="plan_id" value="{{ request.GET.plan|default:'premium' }}">
                                    <input type="hidden" name="duration" value="{{ request.GET.duration|default:'30' }}">
                                    <input type="hidden" name="amount" value="{{ request.GET.amount|default:499 }}">
                                    
                                    <div class="form-control mb-4">
                                        <label class="label">
                                            <span class="label-text">MPESA Phone Number</span>
                                        </label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                                <span class="text-gray-500">+254</span>
                                            </div>
                                            <input type="tel" id="mpesa-phone" name="phone" class="input input-bordered w-full pl-16" placeholder="0712345678" pattern="[0-9]{9}" required>
                                        </div>
                                    </div>
                                    
                                    <button type="submit" id="mpesa-pay" class="btn btn-success w-full">
                                        <i class="fas fa-mobile-alt mr-2"></i> Request Payment
                                    </button>
                                </form>
                                
                                <div class="mt-6 bg-yellow-50 p-4 rounded-lg text-sm text-yellow-800">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    Ensure your phone is nearby and has sufficient funds
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bank Transfer Form -->
                    <div id="bank-transfer" class="payment-method">
                        <div class="py-6">
                            <h3 class="text-xl font-bold mb-4">Bank Transfer Details</h3>
                            <div class="bg-blue-50 p-6 rounded-lg mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div>
                                        <p class="text-sm text-gray-500">Bank Name</p>
                                        <p class="font-medium">Equity Bank Kenya</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">Account Name</p>
                                        <p class="font-medium">PropertyPro Limited</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">Account Number</p>
                                        <p class="font-medium">1234567890</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">Branch</p>
                                        <p class="font-medium">Nairobi CBD</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">SWIFT Code</p>
                                        <p class="font-medium">EQBLKENA</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">Amount</p>
                                        <p class="font-medium">KES {{ request.GET.amount|default:499 }}</p>
                                    </div>
                                </div>
                                
                                <form id="bank-form" method="post" action="{% url 'payment_callback' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="plan_id" value="{{ request.GET.plan|default:'premium' }}">
                                    <input type="hidden" name="duration" value="{{ request.GET.duration|default:'30' }}">
                                    <input type="hidden" name="amount" value="{{ request.GET.amount|default:499 }}">
                                    
                                    <div class="form-control mb-4">
                                        <label class="label">
                                            <span class="label-text">Transaction Reference</span>
                                        </label>
                                        <input type="text" id="bank-reference" name="reference" class="input input-bordered w-full" placeholder="Your name or order number" required>
                                    </div>
                                    
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text">Upload Payment Receipt (Optional)</span>
                                        </label>
                                        <input type="file" name="receipt" class="file-input file-input-bordered w-full">
                                    </div>
                                    
                                    <button type="submit" id="bank-confirm" class="btn btn-primary w-full mt-4">
                                        <i class="fas fa-check-circle mr-2"></i> Confirm Payment
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Security Badges -->
                <div class="flex flex-wrap items-center justify-center gap-6 py-4">
                    <div class="tooltip" data-tip="256-bit SSL Encryption">
                        <div class="flex items-center gap-2 bg-white px-3 py-2 rounded-lg shadow-sm">
                            <i class="fas fa-lock text-green-500"></i>
                            <span class="text-sm">Secure Payment</span>
                        </div>
                    </div>
                    <div class="tooltip" data-tip="PCI DSS Compliant">
                        <div class="flex items-center gap-2 bg-white px-3 py-2 rounded-lg shadow-sm">
                            <i class="fas fa-shield-alt text-blue-500"></i>
                            <span class="text-sm">PCI Compliant</span>
                        </div>
                    </div>
                    <div class="tooltip" data-tip="3D Secure Authentication">
                        <div class="flex items-center gap-2 bg-white px-3 py-2 rounded-lg shadow-sm">
                            <i class="fas fa-fingerprint text-purple-500"></i>
                            <span class="text-sm">3D Secure</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Order Summary -->
            <div class="lg:w-1/3">
                <div class="bg-white rounded-xl shadow-md overflow-hidden sticky top-6">
                    <div class="bg-{{ plan.color|default:'primary' }} text-white p-4">
                        <h3 class="text-xl font-bold">Order Summary</h3>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4 pb-4 border-b">
                            <div>
                                <h4 class="font-semibold">{{ plan.name|default:"Professional Plan" }}</h4>
                                <p class="text-sm text-gray-500">{{ duration_display|default:"Monthly" }} Subscription</p>
                            </div>
                            <span class="font-bold">KES {{ request.GET.amount|default:499 }}</span>
                        </div>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Subtotal</span>
                                <span>KES {{ request.GET.amount|default:499 }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Tax (16%)</span>
                                <span>KES {{ request.GET.tax|default:79.84 }}</span>
                            </div>
                            <div class="flex justify-between font-bold text-lg pt-2 border-t">
                                <span>Total</span>
                                <span>KES {{ request.GET.total|default:578.84 }}</span>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg mb-6">
                            <h4 class="font-semibold text-blue-800 mb-2">What You Get:</h4>
                            <ul class="text-sm space-y-2 text-blue-700">
                                {% if request.GET.features %}
                                    {% with features=request.GET.features.split %}
                                        {% for feature in features %}
                                        <li class="flex items-start">
                                            <svg class="w-4 h-4 mr-2 mt-0.5 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                            </svg>
                                            <span>{{ feature }}</span>
                                        </li>
                                        {% endfor %}
                                    {% endwith %}
                                {% else %}
                                    <li class="flex items-start">
                                        <svg class="w-4 h-4 mr-2 mt-0.5 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span>10 Property Listings</span>
                                    </li>
                                    <li class="flex items-start">
                                        <svg class="w-4 h-4 mr-2 mt-0.5 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span>Featured Listings</span>
                                    </li>
                                    <li class="flex items-start">
                                        <svg class="w-4 h-4 mr-2 mt-0.5 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span>Priority Support</span>
                                    </li>
                                    <li class="flex items-start">
                                        <svg class="w-4 h-4 mr-2 mt-0.5 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span>Detailed Analytics</span>
                                    </li>
                                {% endif %}
                            </ul>
                        </div>
                        
                        <div class="text-center text-sm text-gray-500">
                            <p>By completing your purchase, you agree to our <a href="#" class="text-primary hover:underline">Terms of Service</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Extract URL parameters
            function getUrlParams() {
                const params = {};
                const queryString = window.location.search.substring(1);
                const pairs = queryString.split('&');
                
                pairs.forEach(pair => {
                    const [key, value] = pair.split('=');
                    params[decodeURIComponent(key)] = decodeURIComponent(value || '');
                });
                
                return params;
            }

            const urlParams = getUrlParams();
            
            // Update payment button text if amount is specified
            if (urlParams.amount) {
                const submitText = document.getElementById('submit-text');
                if (submitText) {
                    submitText.textContent = `Pay KES ${urlParams.amount}`;
                }
            }
            
            // Update bank transfer amount if specified
            if (urlParams.amount) {
                const bankAmountElements = document.querySelectorAll('#bank-transfer .font-medium');
                if (bankAmountElements.length > 0) {
                    bankAmountElements[bankAmountElements.length - 1].textContent = `KES ${urlParams.amount}`;
                }
            }

            // Payment Method Tabs
            const tabs = document.querySelectorAll('.payment-tab');
            const methods = document.querySelectorAll('.payment-method');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs and methods
                    tabs.forEach(t => t.classList.remove('active'));
                    methods.forEach(m => m.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding method
                    this.classList.add('active');
                    const methodId = this.getAttribute('data-method');
                    document.getElementById(methodId).classList.add('active');
                });
            });
            
            // Credit Card Preview
            const cardName = document.getElementById('card-name');
            const cardNumber = document.getElementById('card-number');
            const cardExpiry = document.getElementById('card-expiry');
            const cardCvv = document.getElementById('card-cvv');
            
            if (cardName) {
                cardName.addEventListener('input', function() {
                    document.getElementById('card-name-preview').textContent = 
                        this.value.toUpperCase() || 'FULL NAME';
                });
            }
            
            if (cardNumber) {
                cardNumber.addEventListener('input', function() {
                    let value = this.value.replace(/\s/g, '').replace(/(\d{4})/g, '$1 ').trim();
                    if (value === '') value = '•••• •••• •••• ••••';
                    document.getElementById('card-number-preview').textContent = value;
                });
            }
            
            if (cardExpiry) {
                cardExpiry.addEventListener('input', function() {
                    let value = this.value;
                    if (value.length > 2 && !value.includes('/')) {
                        value = value.substring(0, 2) + '/' + value.substring(2);
                    }
                    this.value = value;
                    document.getElementById('card-expiry-preview').textContent = 
                        value || 'MM/YY';
                });
            }
            
            if (cardCvv) {
                cardCvv.addEventListener('input', function() {
                    document.getElementById('card-cvv-preview').textContent = 
                        '•'.repeat(this.value.length) || '•••';
                });
            }
            
            // Form Submission
            const paymentForm = document.getElementById('payment-form');
            if (paymentForm) {
                paymentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    processPayment('credit-card', this);
                });
            }
            
            // MPESA Payment
            const mpesaForm = document.getElementById('mpesa-form');
            if (mpesaForm) {
                mpesaForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const phone = document.getElementById('mpesa-phone');
                    if (phone.value.length !== 10) {
                        phone.focus();
                        return;
                    }
                    processPayment('mpesa', this);
                });
            }
            
            // Bank Transfer Confirmation
            const bankForm = document.getElementById('bank-form');
            if (bankForm) {
                bankForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const reference = document.getElementById('bank-reference');
                    if (reference.value.trim() === '') {
                        reference.focus();
                        return;
                    }
                    processPayment('bank-transfer', this);
                });
            }
            
            // Payment Processing Function
            function processPayment(method, form) {
                // Show processing state
                const buttons = {
                    'credit-card': paymentForm?.querySelector('button[type="submit"]'),
                    'mpesa': document.getElementById('mpesa-pay'),
                    'bank-transfer': document.getElementById('bank-confirm')
                };
                
                const button = buttons[method];
                if (!button) return;
                
                const originalText = button.innerFHTML;
                button.innerHTML = `
                    <span class="payment-processing">
                        <svg class="animate-spin -ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Processing...
                    </span>
                `;
                button.disabled = true;
                
                // Submit the form via AJAX
                const formData = new FormData(form);
                
                fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => response.json())
                .then(data => {F
                    if (data.success) {
                        window.location.href = data.redirect_url || "{% url 'payment_callback' %}";
                    } else {
                        alert(data.message || 'Payment failed. Please try again.');
                        button.disabled = false;
                        button.innerHTML = originalText;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred during payment processing.');
                    button.disabled = false;
                    button.innerHTML = originalText;
                });
            }
            
            // Add ripple effect to buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('button, a.btn')) {
                    const btn = e.target.closest('button, a.btn');
                    if (btn.getAttribute('disabled')) return;
                    
                    const rect = btn.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    const ripple = document.createElement('span');
                    ripple.className = 'ripple-effect';
                    ripple.style.left = `${x}px`;
                    ripple.style.top = `${y}px`;
                    
                    btn.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 600);
                }
            });
        });
    </script>
</body>
</html>
{% endblock %}