<div class="flex">
    <!-- Sidebar -->
    <aside id="filterSidebar" 
        class="fixed md:sticky top-0 left-0 h-full md:h-screen
               w-64 md:w-16 bg-base-200 shadow-xl 
               transition-all duration-300 z-40
               flex flex-col items-center md:items-stretch
               -translate-x-full md:translate-x-0"> <!-- ðŸ‘ˆ fix: hidden by default on mobile -->
        
        <!-- Header (mobile only) -->
        <div class="p-4 flex justify-between items-center w-full md:hidden">
            <h2 class="text-xl font-semibold">Filters</h2>
            <button id="closeSidebar" class="btn btn-sm btn-ghost md:hidden">
                <i class="fa-solid fa-xmark text-lg"></i>
            </button>
        </div>

        <!-- Filter Icon (always visible on desktop) -->
        <button id="expandSidebar" class="btn btn-ghost mt-4 md:mt-6 hidden md:block">
            <i class="fa-solid fa-filter text-xl">Filters</i>
        </button>

        <!-- Filters Content -->
        <div id="filtersContent" 
            class="hidden md:flex-1 md:flex-col md:overflow-y-auto md:space-y-6 p-6">
            
            <!-- Search -->
            <div>
                <label class="block text-sm font-medium mb-2">Search</label>
                <input type="text" name="q" value="{{ search_query }}" placeholder="Location, keywords..."
                       class="input input-bordered w-full"
                       hx-get="{% url 'rentalhouse_index' %}" 
                       hx-trigger="keyup changed delay:500ms" 
                       hx-target="#house-listings" 
                       hx-include="[name='type'], [name='amenities']">
            </div>

            <!-- Property Type -->
            <div>
                <label class="block text-sm font-medium mb-2">Property Type</label>
                <select name="type" class="select select-bordered w-full"
                        hx-get="{% url 'rentalhouse_index' %}" 
                        hx-trigger="change" 
                        hx-target="#house-listings"
                        hx-include="[name='q'], [name='amenities']">
                    <option value="">All Types</option>
                    <option value="AP" {% if selected_type == 'AP' %}selected{% endif %}>Apartment</option>
                    <option value="VL" {% if selected_type == 'VL' %}selected{% endif %}>Villa</option>
                    <option value="ST" {% if selected_type == 'ST' %}selected{% endif %}>Studio</option>
                    <option value="TH" {% if selected_type == 'TH' %}selected{% endif %}>Townhouse</option>
                    <option value="CN" {% if selected_type == 'CN' %}selected{% endif %}>Condominium</option>
                </select>
            </div>

            <!-- Amenities -->
            <div>
                <label class="block text-sm font-medium mb-2">Amenities</label>
                <div class="space-y-2 max-h-40 overflow-y-auto pr-2">
                    {% for amenity in all_amenities %}
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" name="amenities" value="{{ amenity.id }}" 
                               class="checkbox checkbox-sm"
                               {% if amenity.id in selected_amenities %}checked{% endif %}
                               hx-get="{% url 'rentalhouse_index' %}" 
                               hx-trigger="change" 
                               hx-target="#house-listings"
                               hx-include="[name='q'], [name='type']">
                        <span class="text-sm">{{ amenity.name }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- Apply Button -->
            <div class="mt-6">
                <button class="btn btn-primary w-full"
                        hx-get="{% url 'rentalhouse_index' %}" 
                        hx-trigger="click" 
                        hx-target="#house-listings"
                        hx-include="[name='q'], [name='type'], [name='amenities']">
                    Apply Filters
                </button>
            </div>
        </div>
    </aside>

    <!-- Overlay (mobile only) -->
    <div id="overlay" class="hidden fixed inset-0 bg-black/40 z-30 md:hidden"></div>

    <!-- Main Content -->
    <main id="mainContent" class="flex-1 transition-all duration-300 md:ml-16">
        <!-- Open sidebar button (mobile only) -->
        <button id="openSidebar" class="btn btn-outline mb-4 md:hidden">
            <i class="fa-solid fa-filter mr-2"></i> Filters
        </button>

        <!-- Houses Grid -->
        <div id="house-listings" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for house in page_obj %}
            <!-- === Your house card code here === -->
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div class="col-span-full mt-8">
            <div class="join flex justify-center">
                {# pagination code unchanged #}
            </div>
        </div>
        {% endif %}
    </main>
</div>

<script>
    const sidebar = document.getElementById("filterSidebar");
    const overlay = document.getElementById("overlay");
    const expandBtn = document.getElementById("expandSidebar");
    const openBtn = document.getElementById("openSidebar");
    const closeBtn = document.getElementById("closeSidebar");
    const filtersContent = document.getElementById("filtersContent");
    const mainContent = document.getElementById("mainContent");

    let expanded = false;

    // Desktop expand/collapse
    if (expandBtn) {
        expandBtn.addEventListener("click", () => {
            if (expanded) {
                sidebar.classList.remove("md:w-72");
                sidebar.classList.add("md:w-16");
                filtersContent.classList.add("hidden");
                mainContent.classList.remove("md:ml-72");
                mainContent.classList.add("md:ml-16");
                expanded = false;
            } else {
                sidebar.classList.remove("md:w-16");
                sidebar.classList.add("md:w-72");
                filtersContent.classList.remove("hidden");
                mainContent.classList.remove("md:ml-16");
                mainContent.classList.add("md:ml-72");
                expanded = true;
            }
        });
    }

    // Mobile open
    if (openBtn) {
        openBtn.addEventListener("click", () => {
            sidebar.classList.remove("-translate-x-full");
            overlay.classList.remove("hidden");
        });
    }

    // Mobile close
    if (closeBtn) {
        closeBtn.addEventListener("click", () => {
            sidebar.classList.add("-translate-x-full");
            overlay.classList.add("hidden");
        });
    }

    if (overlay) {
        overlay.addEventListener("click", () => {
            sidebar.classList.add("-translate-x-full");
            overlay.classList.add("hidden");
        });
    }
</script>
