<section class="py-20 bg-base-100">
  <div class="max-w-screen-2xl mx-auto px-4">
    <!-- Section Heading -->
    <h2 class="text-3xl md:text-4xl font-bold mb-12 text-center text-primary animate-fade-in-up">
      Similar Properties
    </h2>

    <!-- Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-8">
      {% for similar_property in similar_properties %}
      <a href="{% url 'housing_detail' similar_property.slug %}" 
         aria-label="View details for {{ similar_property.title }}"
         class="card relative bg-base-100 shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-500 ease-out rounded-2xl overflow-hidden opacity-0 reveal-on-scroll">

             <!-- Badges -->
             <div class="absolute top-3 right-3 z-20 flex flex-col gap-2">
               {% if similar_property.is_new %}
               <div class="badge bg-green-600 text-white badge-lg animate-bounce shadow-md">New</div>
               {% endif %}
               {% if similar_property.is_featured %}
               <div class="badge bg-yellow-500 text-white badge-lg shadow-md">Featured</div>
               {% endif %}
               {% if similar_property.is_discount %}
               <div class="badge bg-red-600 text-white badge-lg shadow-md">Discount</div>
               {% endif %}
             </div>

        <!-- Image with overlay -->
        <figure class="relative h-72 md:h-80 lg:h-96 overflow-hidden">
          <img 
            src="{{ similar_property.images.first.url|default:'/static/images/heroimage3.webp' }}" 
            alt="{{ similar_property.title|default:'Property Image' }}" 
            class="w-full h-full object-cover object-center transition-transform duration-700 ease-out hover:scale-110 blur-sm"
            onload="this.classList.remove('blur-sm')"
            loading="lazy"
            width="500"
            height="400">
          <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent"></div>
        </figure>

        <!-- Card Body -->
        <div class="card-body p-6">
          <h3 class="card-title text-xl md:text-2xl font-bold text-gray-800 truncate">
            {{ similar_property.title }}
          </h3>
          <p class="text-sm md:text-base text-gray-500 truncate">
            {{ similar_property.location }}
          </p>

          <!-- Description -->
          {% if similar_property.description %}
          <p class="text-gray-600 text-sm mt-2 line-clamp-2">
            {{ similar_property.description }}
          </p>
          {% endif %}

          <!-- Property Info -->
          <div class="flex justify-between items-center mt-4 text-gray-600 text-sm md:text-base">
            <div class="flex items-center gap-2">
              <i class="fas fa-bed text-primary"></i> {{ similar_property.bedrooms|default:"-" }}
            </div>
            <div class="flex items-center gap-2">
              <i class="fas fa-bath text-blue-500"></i> {{ similar_property.bathrooms|default:"-" }}
            </div>
            <div class="flex items-center gap-2">
              <i class="fas fa-car text-success"></i> {{ similar_property.parking|default:"-" }}
            </div>
          </div>

          <!-- Price & Type -->
          <div class="flex flex-wrap justify-between items-center mt-5 gap-2">
            <span class="font-bold text-success text-lg md:text-xl">
              KSh {{ similar_property.price }}
            </span>
            <span class="font-semibold text-blue-500 text-sm md:text-base">
              {{ similar_property.type }}
            </span>
            <div class="badge badge-outline">{{ similar_property.size }}</div>
          </div>
        </div>
      </a>
      {% empty %}
      <div class="col-span-5 text-gray-500 text-center py-12 animate-fade-in-up">
        No similar properties found
      </div>
      {% endfor %}
    </div>

    <!-- Button -->
    <div class="text-center mt-14">
      <a href="{% url 'listing' %}?location={{ house.location }}&house_type={{ house.house_type }}" 
         class="btn btn-primary btn-outline btn-lg rounded-full transition-all duration-500 hover:scale-110 hover:shadow-2xl hover:bg-primary hover:text-white focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
        View All Similar Properties
      </a>
    </div>
  </div>
</section>

<!-- Animations -->
<style>
@keyframes fade-in-up {
  from { opacity: 0; transform: translateY(25px);}
  to { opacity: 1; transform: translateY(0);}
}
.animate-fade-in-up {
  animation: fade-in-up 0.8s ease-out forwards;
}
.reveal-on-scroll {
  opacity: 0;
  transform: translateY(25px);
  transition: opacity 0.8s ease-out, transform 0.8s ease-out;
}
.reveal-on-scroll.visible {
  opacity: 1;
  transform: translateY(0);
}
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>

<!-- Intersection Observer -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const elements = document.querySelectorAll(".reveal-on-scroll");
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, i) => {
      if (entry.isIntersecting) {
        entry.target.style.transitionDelay = `${i * 100}ms`; // stagger
        entry.target.classList.add("visible");
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.15 });

  elements.forEach((el) => observer.observe(el));
});
</script>
